<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">
	<changeSet id="003:01-create-tenant-table"
		author="flowinquiry">
		<createTable tableName="fw_tenant">
			<column name="id" type="UUID">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="name" type="VARCHAR(100)">
				<constraints nullable="false" />
			</column>

			<!-- Unique human-readable and URL-safe tenant identifier -->
			<column name="slug" type="VARCHAR(100)">
				<constraints nullable="false" unique="true" />
			</column>

			<!-- Actual domain used to route: could be subdomain or dedicated domain -->
			<column name="domain" type="VARCHAR(255)">
				<constraints unique="true" nullable="false" />
			</column>

			<!-- Indicates whether tenant uses subdomain or full custom domain -->
			<column name="access_type" type="VARCHAR(20)"
				defaultValue="SUBDOMAIN">
				<constraints nullable="false" />
			</column>

			<column name="created_at" type="TIMESTAMP">
				<constraints nullable="false" />
			</column>

			<column name="modified_at" type="TIMESTAMP">
				<constraints nullable="false" />
			</column>
		</createTable>

		<!-- Insert default tenant for self-host mode -->
		<insert tableName="fw_tenant">
			<column name="id" value="00000000-0000-0000-0000-000000000001" />
			<column name="name" value="Self Host" />
			<column name="slug" value="self-host" />
			<column name="domain" value="localhost" />
			<column name="access_type" value="SELF_HOSTED" />
			<column name="created_at" valueDate="NOW()" />
			<column name="modified_at" valueDate="NOW()" />
		</insert>
	</changeSet>

	<changeSet
		id="003:02-alter-tenant_relationship-to-activity-log-table"
		author="flowinquiry">
		<addColumn tableName="fw_activity_log">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_activity_log">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint tableName="fw_activity_log"
			columnName="tenant_id" columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_activity_log" baseColumnNames="tenant_id"
			constraintName="fk_activity_log_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex indexName="idx_fw_activity_log_tenant_id"
			tableName="fw_activity_log">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:03-alter-tenant_relationship-to-app-settings-table"
		author="flowinquiry">
		<addColumn tableName="fw_app_settings">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_app_settings">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint tableName="fw_app_settings"
			columnName="tenant_id" columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_app_settings" baseColumnNames="tenant_id"
			constraintName="fk_fw_app_settings_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex indexName="idx_fw_app_settings_tenant_id"
			tableName="fw_app_settings">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:04-alter-tenant_relationship-to-authority-table"
		author="flowinquiry">
		<addColumn tableName="fw_authority">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_authority">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint tableName="fw_authority"
			columnName="tenant_id" columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_authority" baseColumnNames="tenant_id"
			constraintName="fk_fw_authority_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex indexName="idx_fw_authority_tenant_id"
			tableName="fw_authority">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:05-alter-tenant_relationship-to-authority-resource-permission-table"
		author="flowinquiry">
		<addColumn tableName="fw_authority_resource_permission">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_authority_resource_permission">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint
			tableName="fw_authority_resource_permission" columnName="tenant_id"
			columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_authority_resource_permission"
			baseColumnNames="tenant_id"
			constraintName="fk_fw_authority_resource_permission_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex
			indexName="idx_fw_authority_resource_permission_tenant_id"
			tableName="fw_authority_resource_permission">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:05-alter-tenant_relationship-to-comment-table"
		author="flowinquiry">
		<addColumn tableName="fw_comment">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_comment">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint tableName="fw_comment"
			columnName="tenant_id" columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_comment" baseColumnNames="tenant_id"
			constraintName="fk_fw_comment_tenant" referencedTableName="fw_tenant"
			referencedColumnNames="id" />
		<createIndex indexName="idx_fw_comment_tenant_id"
			tableName="fw_comment">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:06-alter-tenant_relationship-to-entity-attachment-table"
		author="flowinquiry">
		<addColumn tableName="fw_entity_attachment">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_entity_attachment">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint
			tableName="fw_entity_attachment" columnName="tenant_id"
			columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_entity_attachment" baseColumnNames="tenant_id"
			constraintName="fk_fw_entity_attachment_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex
			indexName="idx_fw_entity_attachment_tenant_id"
			tableName="fw_entity_attachment">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:07-alter-tenant_relationship-to-entity-watchers-table"
		author="flowinquiry">
		<addColumn tableName="fw_entity_watchers">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_entity_watchers">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint
			tableName="fw_entity_watchers" columnName="tenant_id"
			columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_entity_watchers" baseColumnNames="tenant_id"
			constraintName="fk_fw_entity_watchers_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex indexName="idx_fw_entity_watchers_tenant_id"
			tableName="fw_entity_watchers">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:08-alter-tenant_relationship-to-escalation-tracking-table"
		author="flowinquiry">
		<addColumn tableName="fw_escalation_tracking">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_escalation_tracking">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint
			tableName="fw_escalation_tracking" columnName="tenant_id"
			columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_escalation_tracking" baseColumnNames="tenant_id"
			constraintName="fk_fw_escalation_tracking_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex
			indexName="idx_fw_escalation_tracking_tenant_id"
			tableName="fw_escalation_tracking">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:09-alter-tenant_relationship-to-notification-table"
		author="flowinquiry">
		<addColumn tableName="fw_notification">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_notification">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint tableName="fw_notification"
			columnName="tenant_id" columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_notification" baseColumnNames="tenant_id"
			constraintName="fk_fw_notification_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex indexName="idx_fw_notification_tenant_id"
			tableName="fw_notification">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:10-alter-tenant_relationship-to-organization-table"
		author="flowinquiry">
		<addColumn tableName="fw_organization">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_organization">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint tableName="fw_organization"
			columnName="tenant_id" columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_organization" baseColumnNames="tenant_id"
			constraintName="fk_fw_organization_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex indexName="idx_fw_organization_tenant_id"
			tableName="fw_organization">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:11-alter-tenant_relationship-to-project-table"
		author="flowinquiry">
		<addColumn tableName="fw_project">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_project">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint tableName="fw_project"
			columnName="tenant_id" columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_project" baseColumnNames="tenant_id"
			constraintName="fk_fw_project_tenant" referencedTableName="fw_tenant"
			referencedColumnNames="id" />
		<createIndex indexName="idx_fw_project_tenant_id"
			tableName="fw_project">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:12-alter-tenant_relationship-to-project-epic-table"
		author="flowinquiry">
		<addColumn tableName="fw_project_epic">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_project_epic">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint tableName="fw_project_epic"
			columnName="tenant_id" columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_project_epic" baseColumnNames="tenant_id"
			constraintName="fk_fw_project_epic_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex indexName="idx_fw_project_epic_tenant_id"
			tableName="fw_project_epic">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:13-alter-tenant_relationship-to-project-iteration-table"
		author="flowinquiry">
		<addColumn tableName="fw_project_iteration">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_project_iteration">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint
			tableName="fw_project_iteration" columnName="tenant_id"
			columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_project_iteration" baseColumnNames="tenant_id"
			constraintName="fk_fw_project_iteration_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex
			indexName="idx_fw_project_iteration_tenant_id"
			tableName="fw_project_iteration">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:14-alter-tenant_relationship-to-project-setting-table"
		author="flowinquiry">
		<addColumn tableName="fw_project_setting">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_project_setting">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint
			tableName="fw_project_setting" columnName="tenant_id"
			columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_project_setting" baseColumnNames="tenant_id"
			constraintName="fk_fw_project_setting_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex indexName="idx_fw_project_setting_tenant_id"
			tableName="fw_project_setting">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:15-alter-tenant_relationship-to-team-table"
		author="flowinquiry">
		<addColumn tableName="fw_team">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_team">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint tableName="fw_team"
			columnName="tenant_id" columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_team" baseColumnNames="tenant_id"
			constraintName="fk_fw_team_tenant" referencedTableName="fw_tenant"
			referencedColumnNames="id" />
		<createIndex indexName="idx_fw_team_tenant_id"
			tableName="fw_team">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:16-alter-tenant_relationship-to-team-role-table"
		author="flowinquiry">
		<addColumn tableName="fw_team_role">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_team_role">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint tableName="fw_team_role"
			columnName="tenant_id" columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_team_role" baseColumnNames="tenant_id"
			constraintName="fk_fw_team_role_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex indexName="idx_fw_team_role_tenant_id"
			tableName="fw_team_role">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:17-alter-tenant_relationship-to-team-workflow-selection-table"
		author="flowinquiry">
		<addColumn tableName="fw_team_workflow_selection">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_team_workflow_selection">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint
			tableName="fw_team_workflow_selection" columnName="tenant_id"
			columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_team_workflow_selection"
			baseColumnNames="tenant_id"
			constraintName="fk_fw_team_workflow_selection_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex
			indexName="idx_fw_team_workflow_selection_tenant_id"
			tableName="fw_team_workflow_selection">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:18-alter-tenant_relationship-to-ticket-table"
		author="flowinquiry">
		<addColumn tableName="fw_ticket">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_ticket">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint tableName="fw_ticket"
			columnName="tenant_id" columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_ticket" baseColumnNames="tenant_id"
			constraintName="fk_fw_ticket_tenant" referencedTableName="fw_tenant"
			referencedColumnNames="id" />
		<createIndex indexName="idx_fw_ticket_tenant_id"
			tableName="fw_ticket">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:19-alter-tenant_relationship-to-ticket-conversation-health-table"
		author="flowinquiry">
		<addColumn tableName="fw_ticket_conversation_health">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_ticket_conversation_health">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint
			tableName="fw_ticket_conversation_health" columnName="tenant_id"
			columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_ticket_conversation_health"
			baseColumnNames="tenant_id"
			constraintName="fk_fw_ticket_conversation_health_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex
			indexName="idx_fw_ticket_conversation_health_tenant_id"
			tableName="fw_ticket_conversation_health">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:20-alter-tenant_relationship-to-user-table"
		author="flowinquiry">
		<addColumn tableName="fw_user">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_user">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint tableName="fw_user"
			columnName="tenant_id" columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_user" baseColumnNames="tenant_id"
			constraintName="fk_fw_user_tenant" referencedTableName="fw_tenant"
			referencedColumnNames="id" />
		<createIndex indexName="idx_fw_user_tenant_id"
			tableName="fw_user">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:21-alter-tenant_relationship-to-user-auth-table"
		author="flowinquiry">
		<addColumn tableName="fw_user_auth">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_user_auth">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint tableName="fw_user_auth"
			columnName="tenant_id" columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_user_auth" baseColumnNames="tenant_id"
			constraintName="fk_fw_user_auth_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex indexName="idx_fw_user_auth_tenant_id"
			tableName="fw_user_auth">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>

	<changeSet
		id="003:23-alter-tenant_relationship-to-user-team-table"
		author="flowinquiry">
		<addColumn tableName="fw_user_team">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_user_team">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint tableName="fw_user_team"
			columnName="tenant_id" columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_user_team" baseColumnNames="tenant_id"
			constraintName="fk_fw_user_team_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex indexName="idx_fw_user_team_tenant_id"
			tableName="fw_user_team">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:24-alter-tenant_relationship-to-workflow-table"
		author="flowinquiry">
		<addColumn tableName="fw_workflow">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_workflow">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint tableName="fw_workflow"
			columnName="tenant_id" columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_workflow" baseColumnNames="tenant_id"
			constraintName="fk_fw_workflow_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex indexName="idx_fw_workflow_tenant_id"
			tableName="fw_workflow">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:25-alter-tenant_relationship-to-workflow-actions-table"
		author="flowinquiry">
		<addColumn tableName="fw_workflow_actions">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_workflow_actions">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint
			tableName="fw_workflow_actions" columnName="tenant_id"
			columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_workflow_actions" baseColumnNames="tenant_id"
			constraintName="fk_fw_workflow_actions_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex indexName="idx_fw_workflow_actions_tenant_id"
			tableName="fw_workflow_actions">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:26-alter-tenant_relationship-to-workflow-state-table"
		author="flowinquiry">
		<addColumn tableName="fw_workflow_state">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_workflow_state">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint
			tableName="fw_workflow_state" columnName="tenant_id"
			columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_workflow_state" baseColumnNames="tenant_id"
			constraintName="fk_fw_workflow_state_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex indexName="idx_fw_workflow_state_tenant_id"
			tableName="fw_workflow_state">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:27-alter-tenant_relationship-to-workflow-transition-table"
		author="flowinquiry">
		<addColumn tableName="fw_workflow_transition">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_workflow_transition">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint
			tableName="fw_workflow_transition" columnName="tenant_id"
			columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_workflow_transition" baseColumnNames="tenant_id"
			constraintName="fk_fw_workflow_transition_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex
			indexName="idx_fw_workflow_transition_tenant_id"
			tableName="fw_workflow_transition">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet
		id="003:28-alter-tenant_relationship-to-workflow-transition-history-table"
		author="flowinquiry">
		<addColumn tableName="fw_workflow_transition_history">
			<column name="tenant_id" type="UUID" />
		</addColumn>

		<update tableName="fw_workflow_transition_history">
			<column name="tenant_id"
				value="00000000-0000-0000-0000-000000000001" />
		</update>

		<addNotNullConstraint
			tableName="fw_workflow_transition_history" columnName="tenant_id"
			columnDataType="UUID" />

		<addForeignKeyConstraint
			baseTableName="fw_workflow_transition_history"
			baseColumnNames="tenant_id"
			constraintName="fk_fw_workflow_transition_history_tenant"
			referencedTableName="fw_tenant" referencedColumnNames="id" />
		<createIndex
			indexName="idx_fw_workflow_transition_history_tenant_id"
			tableName="fw_workflow_transition_history">
			<column name="tenant_id" />
		</createIndex>
	</changeSet>
	<changeSet id="003:21-remove-redundant-fields-of-tables"
		author="flowinquiry">
		<dropColumn tableName="fw_activity_log"
			columnName="updated_at" />
		<dropColumn tableName="fw_notification"
			columnName="modified_by" />
		<dropColumn tableName="fw_notification"
			columnName="modified_at" />
		<addColumn tableName="fw_entity_attachment">
			<column name="created_by" type="BIGINT">
				<constraints nullable="true" />
			</column>
			<column name="created_at" type="timestamptz">
				<constraints nullable="false" />
			</column>
		</addColumn>
		<addForeignKeyConstraint
			baseTableName="fw_entity_attachment" baseColumnNames="created_by"
			constraintName="fk_entity_attachment_created_by"
			referencedTableName="fw_user" referencedColumnNames="id"
			deferrable="false" initiallyDeferred="false" onDelete="SET NULL" />

		<addColumn tableName="fw_organization">
			<column name="created_by" type="BIGINT">
				<constraints nullable="true" />
			</column>
			<column name="created_at" type="timestamptz">
				<constraints nullable="true" />
			</column>
			<column name="modified_by" type="BIGINT">
				<constraints nullable="true" />
			</column>
			<column name="modified_at" type="timestamptz">
				<constraints nullable="true" />
			</column>
		</addColumn>

		<addForeignKeyConstraint
			baseTableName="fw_organization" baseColumnNames="created_by"
			constraintName="fk_organization_created_by"
			referencedTableName="fw_user" referencedColumnNames="id"
			onDelete="SET NULL" />

		<addForeignKeyConstraint
			baseTableName="fw_organization" baseColumnNames="modified_by"
			constraintName="fk_organization_modified_by"
			referencedTableName="fw_user" referencedColumnNames="id"
			onDelete="SET NULL" />

		<addColumn tableName="fw_authority">
			<column name="created_by" type="BIGINT">
				<constraints nullable="true" />
			</column>
			<column name="created_at" type="timestamptz">
				<constraints nullable="true" />
			</column>
			<column name="modified_by" type="BIGINT">
				<constraints nullable="true" />
			</column>
			<column name="modified_at" type="timestamptz">
				<constraints nullable="true" />
			</column>
		</addColumn>

		<addForeignKeyConstraint
			baseTableName="fw_authority" baseColumnNames="created_by"
			constraintName="fk_authority_created_by"
			referencedTableName="fw_user" referencedColumnNames="id"
			onDelete="SET NULL" />

		<addForeignKeyConstraint
			baseTableName="fw_authority" baseColumnNames="modified_by"
			constraintName="fk_authority_modified_by"
			referencedTableName="fw_user" referencedColumnNames="id"
			onDelete="SET NULL" />

		<!-- Drop old FK -->
		<dropForeignKeyConstraint
			baseTableName="fw_ticket" constraintName="fk_team_request_team_id" />

		<!-- Add FK with ON DELETE CASCADE -->
		<addForeignKeyConstraint
			baseTableName="fw_ticket" baseColumnNames="team_id"
			constraintName="fk_ticket_team_id" referencedTableName="fw_team"
			referencedColumnNames="id" onDelete="CASCADE" />

		<addColumn tableName="fw_team">
			<column name="created_by" type="BIGINT">
				<constraints nullable="true" />
			</column>
			<column name="created_at" type="timestamptz">
				<constraints nullable="true" />
			</column>
			<column name="modified_by" type="BIGINT">
				<constraints nullable="true" />
			</column>
			<column name="modified_at" type="timestamptz">
				<constraints nullable="true" />
			</column>
		</addColumn>
	</changeSet>
</databaseChangeLog>
